version: '3.8'

services:
  blazegraph:
    image: lyrasis/blazegraph:2.1.5
    ports:
      - '8081:8080'
    volumes:
      - ./.docker/blazegraph.ini:/RWStore.properties:ro
      - ./data/:/data/:ro
  blazegraph-data:
    image: curlimages/curl:7.76.1
    depends_on:
      - blazegraph
    entrypoint: ""
    command: ["/wait-for.sh", "blazegraph:8080", "--", "curl", "--fail-with-body", "--data-binary", "@/load-data.ini", "--header", "Content-Type: text/plain", "http://blazegraph:8080/bigdata/dataloader"]
    volumes:
      - ./.docker/load-data.ini:/load-data.ini:ro
      - ./.docker/wait-for.sh:/wait-for.sh:ro
  client:
    build:
      context: client
    environment:
      SPARQL_URL: http://blazegraph:8080/bigdata/namespace/kb/sparql
    ports:
      - '8082:8082'
    volumes:
      - ./client/web/:/app/web/:ro
    deploy:
      restart_policy:
        condition: on-failure
  trifid:
    build:
      context: trifid
    ports:
      - '8080:8080'
